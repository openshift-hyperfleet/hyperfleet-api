openapi: 3.0.0
info:
  contact:
    name: HyperFleet Team
  description: |-
    HyperFleet API provides simple CRUD operations for managing cluster resources and their status history.

    **Architecture**: Simple CRUD only, no business logic, no event creation.
    Sentinel operator handles all orchestration logic.
    Adapters handle the specifics of managing spec
  title: HyperFleet API
  version: 1.0.0
servers:
- description: Development
  url: http://localhost:8000
paths:
  /api/hyperfleet/v1/clusters:
    get:
      operationId: getClusters
      parameters:
      - explode: false
        in: query
        name: page
        required: false
        schema:
          default: 1
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: pageSize
        required: false
        schema:
          default: 20
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: orderBy
        required: false
        schema:
          default: created_at
          type: string
        style: form
      - explode: false
        in: query
        name: order
        required: false
        schema:
          $ref: "#/components/schemas/OrderDirection"
        style: form
      - explode: false
        in: query
        name: search
        required: false
        schema:
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ClusterList"
          description: The request has succeeded.
        default:
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: An unexpected error response.
      summary: List clusters
    post:
      description: |-
        Create a new cluster resource.

        **Note**: The `status` object in the response is read-only and computed by the service.
        It is NOT part of the request body. Initially, status.phase will be "NotReady" and
        status.adapters will be empty until adapters POST their status.
      operationId: postCluster
      parameters: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ClusterCreateRequest"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cluster"
          description: The request has succeeded and a new resource has been created
            as a result.
        default:
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: An unexpected error response.
      summary: Create cluster
  /api/hyperfleet/v1/clusters/{cluster_id}:
    get:
      operationId: getClusterById
      parameters:
      - explode: false
        in: query
        name: search
        required: false
        schema:
          type: string
        style: form
      - explode: false
        in: path
        name: cluster_id
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Cluster"
          description: The request has succeeded.
        default:
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: An unexpected error response.
      summary: Get cluster by ID
  /api/hyperfleet/v1/clusters/{cluster_id}/nodepools:
    get:
      description: Returns the list of all nodepools for a cluster
      operationId: getNodePoolsByClusterId
      parameters:
      - description: Cluster ID
        explode: false
        in: path
        name: cluster_id
        required: true
        schema:
          type: string
        style: simple
      - explode: false
        in: query
        name: page
        required: false
        schema:
          default: 1
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: pageSize
        required: false
        schema:
          default: 20
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: orderBy
        required: false
        schema:
          default: created_at
          type: string
        style: form
      - explode: false
        in: query
        name: order
        required: false
        schema:
          $ref: "#/components/schemas/OrderDirection"
        style: form
      - explode: false
        in: query
        name: search
        required: false
        schema:
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodePoolList"
          description: The request has succeeded.
        default:
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: An unexpected error response.
      summary: List all nodepools for cluster
    post:
      description: Create a NodePool for a cluster
      operationId: createNodePool
      parameters:
      - description: Cluster ID
        explode: false
        in: path
        name: cluster_id
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/NodePoolCreateRequest"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodePoolCreateResponse"
          description: The request has succeeded and a new resource has been created
            as a result.
        default:
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: An unexpected error response.
      summary: Create nodepool
  /api/hyperfleet/v1/clusters/{cluster_id}/nodepools/{nodepool_id}:
    get:
      description: Returns specific nodepool
      operationId: getNodePoolById
      parameters:
      - description: Cluster ID
        explode: false
        in: path
        name: cluster_id
        required: true
        schema:
          type: string
        style: simple
      - description: NodePool ID
        explode: false
        in: path
        name: nodepool_id
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodePool"
          description: The request has succeeded.
        default:
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: An unexpected error response.
      summary: Get nodepool by ID
  /api/hyperfleet/v1/clusters/{cluster_id}/nodepools/{nodepool_id}/statuses:
    get:
      description: Returns current status object for each adapter that has reported
        status
      operationId: getNodePoolsStatuses
      parameters:
      - description: Cluster ID
        explode: false
        in: path
        name: cluster_id
        required: true
        schema:
          type: string
        style: simple
      - explode: false
        in: path
        name: nodepool_id
        required: true
        schema:
          type: string
        style: simple
      - explode: false
        in: query
        name: page
        required: false
        schema:
          default: 1
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: pageSize
        required: false
        schema:
          default: 20
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: orderBy
        required: false
        schema:
          default: created_at
          type: string
        style: form
      - explode: false
        in: query
        name: order
        required: false
        schema:
          $ref: "#/components/schemas/OrderDirection"
        style: form
      - explode: false
        in: query
        name: search
        required: false
        schema:
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdapterStatusList"
          description: The request has succeeded.
        default:
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: An unexpected error response.
      summary: List all adapter statuses for nodepools
    post:
      description: "Adapter creates its initial status object for this cluster.\n\
        Returns 409 if adapter already has a status object for this cluster \n\nResponse\
        \ includes the status id and href for future operations.\nAdapter should store\
        \ the returned id/href to update its status later."
      operationId: postNodePoolStatuses
      parameters:
      - description: Cluster ID
        explode: false
        in: path
        name: cluster_id
        required: true
        schema:
          type: string
        style: simple
      - explode: false
        in: path
        name: nodepool_id
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdapterStatusCreateRequest"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdapterStatus"
          description: The request has succeeded and a new resource has been created
            as a result.
        "400":
          description: The server could not understand the request due to invalid
            syntax.
        "404":
          description: The server cannot find the requested resource.
        "409":
          description: The request conflicts with the current state of the server.
      summary: Create adapter status
  /api/hyperfleet/v1/clusters/{cluster_id}/statuses:
    get:
      description: Returns current status object for each adapter that has reported
        status
      operationId: getClusterStatuses
      parameters:
      - description: Cluster ID
        explode: false
        in: path
        name: cluster_id
        required: true
        schema:
          type: string
        style: simple
      - explode: false
        in: query
        name: page
        required: false
        schema:
          default: 1
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: pageSize
        required: false
        schema:
          default: 20
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: orderBy
        required: false
        schema:
          default: created_at
          type: string
        style: form
      - explode: false
        in: query
        name: order
        required: false
        schema:
          $ref: "#/components/schemas/OrderDirection"
        style: form
      - explode: false
        in: query
        name: search
        required: false
        schema:
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdapterStatusList"
          description: The request has succeeded.
        "404":
          description: The server cannot find the requested resource.
      summary: List all adapter statuses for cluster
    post:
      description: "Adapter creates its initial status object for this cluster.\n\
        Returns 409 if adapter already has a status object for this cluster \n\nResponse\
        \ includes the status id and href for future operations.\nAdapter should store\
        \ the returned id/href to update its status later."
      operationId: postClusterStatuses
      parameters:
      - description: Cluster ID
        explode: false
        in: path
        name: cluster_id
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AdapterStatusCreateRequest"
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AdapterStatus"
          description: The request has succeeded and a new resource has been created
            as a result.
        "400":
          description: The server could not understand the request due to invalid
            syntax.
        "404":
          description: The server cannot find the requested resource.
        "409":
          description: The request conflicts with the current state of the server.
      summary: Create adapter status
  /api/hyperfleet/v1/compatibility:
    get:
      description: Returns the list of all nodepools
      operationId: getCompatibility
      parameters:
      - explode: false
        in: query
        name: page
        required: false
        schema:
          default: 1
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: pageSize
        required: false
        schema:
          default: 20
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: orderBy
        required: false
        schema:
          default: created_at
          type: string
        style: form
      - explode: false
        in: query
        name: order
        required: false
        schema:
          $ref: "#/components/schemas/OrderDirection"
        style: form
      - explode: false
        in: query
        name: search
        required: false
        schema:
          type: string
        style: form
      responses:
        "200":
          content:
            text/plain:
              schema:
                type: string
          description: The request has succeeded.
      security:
      - BearerAuth: []
  /api/hyperfleet/v1/nodepools:
    get:
      description: Returns the list of all nodepools
      operationId: getNodePools
      parameters:
      - explode: false
        in: query
        name: page
        required: false
        schema:
          default: 1
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: pageSize
        required: false
        schema:
          default: 20
          format: int32
          type: integer
        style: form
      - explode: false
        in: query
        name: orderBy
        required: false
        schema:
          default: created_at
          type: string
        style: form
      - explode: false
        in: query
        name: order
        required: false
        schema:
          $ref: "#/components/schemas/OrderDirection"
        style: form
      - explode: false
        in: query
        name: search
        required: false
        schema:
          type: string
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NodePoolList"
          description: The request has succeeded.
        default:
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
          description: An unexpected error response.
      summary: List all nodepools for cluster
components:
  parameters:
    QueryParams.order:
      explode: false
      in: query
      name: order
      required: false
      schema:
        $ref: "#/components/schemas/OrderDirection"
      style: form
    QueryParams.orderBy:
      explode: false
      in: query
      name: orderBy
      required: false
      schema:
        default: created_at
        type: string
      style: form
    QueryParams.page:
      explode: false
      in: query
      name: page
      required: false
      schema:
        default: 1
        format: int32
        type: integer
      style: form
    QueryParams.pageSize:
      explode: false
      in: query
      name: pageSize
      required: false
      schema:
        default: 20
        format: int32
        type: integer
      style: form
    SearchParams:
      explode: false
      in: query
      name: search
      required: false
      schema:
        type: string
      style: form
  schemas:
    APIResource:
      allOf:
      - $ref: "#/components/schemas/ObjectReference"
      properties:
        labels:
          additionalProperties:
            type: string
          description: labels for the API resource as pairs of name:value strings
          type: object
      type: object
    AdapterStatus:
      example:
        adapter: validator
        observed_generation: 1
        conditions:
        - adapter: validator
          type: Available
          status: "True"
          reason: All validations passed
          message: All 30 validation tests passed
          observed_generation: 1
          created_at: 2021-01-01T00:00:00Z
          updated_at: 2021-01-01T00:00:00Z
        - adapter: validator
          type: Applied
          status: "True"
          reason: Validation job applied
          message: Validation job applied successfully
          observed_generation: 1
          created_at: 2021-01-01T00:00:00Z
          updated_at: 2021-01-01T00:00:00Z
        - adapter: validator
          type: Health
          status: "True"
          reason: Validation job healthy
          message: Validation job is healthy
          observed_generation: 1
          created_at: 2021-01-01T00:00:00Z
          updated_at: 2021-01-01T00:00:00Z
        data:
          providerProperty1: providerValue1
          providerProperty2: providerValue2
        metadata:
          job_name: validator-job
          job_namespace: default
          attempt: 1
          started_at: 2021-01-01T00:00:00Z
          completed_at: 2021-01-01T00:00:00Z
          duration: 10s
      properties:
        adapter:
          description: "Name of the adapter that generated this status (Validator,\
            \ DNS...)"
          type: string
        observed_generation:
          description: "Which generation for an entity (Clusters, NodePools) was current\
            \ at the time of creating this status"
          format: int32
          type: integer
        conditions:
          description: Kubernetes-style conditions tracking adapter state
          items:
            $ref: "#/components/schemas/Condition"
          type: array
        data:
          additionalProperties: {}
          description: Adapter-specific data (structure varies by adapter type)
          type: object
        metadata:
          $ref: "#/components/schemas/AdapterStatus_metadata"
      required:
      - adapter
      - conditions
      - observed_generation
      type: object
    AdapterStatusCreateRequest:
      example:
        metadata:
          key: ""
        adapter: adapter
        data:
          key: ""
        conditions:
        - reason: reason
          adapter: adapter
          updated_at: 2000-01-23T04:56:07.000+00:00
          created_at: 2000-01-23T04:56:07.000+00:00
          last_transition_time: 2000-01-23T04:56:07.000+00:00
          type: type
          message: message
          observed_generation: 6
          status: "True"
        - reason: reason
          adapter: adapter
          updated_at: 2000-01-23T04:56:07.000+00:00
          created_at: 2000-01-23T04:56:07.000+00:00
          last_transition_time: 2000-01-23T04:56:07.000+00:00
          type: type
          message: message
          observed_generation: 6
          status: "True"
        observed_generation: 0
      properties:
        adapter:
          description: Adapter identifier
          type: string
        observed_generation:
          description: Which cluster generation this status reflects
          format: int32
          type: integer
        conditions:
          items:
            $ref: "#/components/schemas/Condition"
          type: array
        data:
          additionalProperties: {}
          description: Adapter-specific data
          type: object
        metadata:
          additionalProperties: {}
          description: Job execution metadata
          type: object
      required:
      - adapter
      - conditions
      - observed_generation
      type: object
    AdapterStatusList:
      allOf:
      - $ref: "#/components/schemas/List"
      example:
        items:
        - adapter: validator
          observed_generation: 1
          conditions:
          - adapter: validator
            type: Available
            status: "True"
            reason: All validations passed
            message: All 30 validation tests passed
            observed_generation: 1
            created_at: 2021-01-01T00:00:00Z
            updated_at: 2021-01-01T00:00:00Z
          - adapter: validator
            type: Applied
            status: "True"
            reason: Validation job applied
            message: Validation job applied successfully
            observed_generation: 1
            created_at: 2021-01-01T00:00:00Z
            updated_at: 2021-01-01T00:00:00Z
          - adapter: validator
            type: Health
            status: "True"
            reason: Validation job healthy
            message: Validation job is healthy
            observed_generation: 1
            created_at: 2021-01-01T00:00:00Z
            updated_at: 2021-01-01T00:00:00Z
          data:
            providerProperty1: providerValue1
            providerProperty2: providerValue2
          metadata:
            job_name: validator-job
            job_namespace: default
            attempt: 1
            started_at: 2021-01-01T00:00:00Z
            completed_at: 2021-01-01T00:00:00Z
            duration: 10s
        - adapter: validator
          observed_generation: 1
          conditions:
          - adapter: validator
            type: Available
            status: "True"
            reason: All validations passed
            message: All 30 validation tests passed
            observed_generation: 1
            created_at: 2021-01-01T00:00:00Z
            updated_at: 2021-01-01T00:00:00Z
          - adapter: validator
            type: Applied
            status: "True"
            reason: Validation job applied
            message: Validation job applied successfully
            observed_generation: 1
            created_at: 2021-01-01T00:00:00Z
            updated_at: 2021-01-01T00:00:00Z
          - adapter: validator
            type: Health
            status: "True"
            reason: Validation job healthy
            message: Validation job is healthy
            observed_generation: 1
            created_at: 2021-01-01T00:00:00Z
            updated_at: 2021-01-01T00:00:00Z
          data:
            providerProperty1: providerValue1
            providerProperty2: providerValue2
          metadata:
            job_name: validator-job
            job_namespace: default
            attempt: 1
            started_at: 2021-01-01T00:00:00Z
            completed_at: 2021-01-01T00:00:00Z
            duration: 10s
      properties:
        items:
          items:
            $ref: "#/components/schemas/AdapterStatus"
          type: array
      required:
      - items
      type: object
    Cluster:
      allOf:
      - $ref: "#/components/schemas/ClusterBase"
      example:
        kind: Cluster
        id: cluster-123
        href: https://api.hyperfleet.com/v1/clusters/cluster-123
        name: cluster-123
        labels:
          environment: production
          team: platform
        spec: {}
        created_at: 2021-01-01T00:00:00Z
        updated_at: 2021-01-01T00:00:00Z
        generation: 1
        status:
          phase: Ready
          last_transition_time: 2021-01-01T00:00:00Z
          observed_generation: 1
          updated_at: 2021-01-01T00:00:00Z
          adapters:
          - adapter: validator
            type: Available
            status: "True"
            reason: All validations passed
            message: All 30 validation tests passed
            observed_generation: 1
            created_at: 2021-01-01T00:00:00Z
            updated_at: 2021-01-01T00:00:00Z
          - adapter: dns
            type: Available
            status: "True"
            reason: DNS records created
            message: custom.domain.com created
            observed_generation: 1
            created_at: 2021-01-01T00:00:00Z
            updated_at: 2021-01-01T00:00:00Z
        created_by: user-123@example.com
        updated_by: user-123@example.com
      properties:
        created_at:
          format: date-time
          type: string
        updated_at:
          format: date-time
          type: string
        created_by:
          format: email
          type: string
        updated_by:
          format: email
          type: string
        generation:
          description: "Generation field is updated on customer updates, reflecting\
            \ the version of the \"intent\" of the customer"
          format: int32
          minimum: 1
          type: integer
        status:
          $ref: "#/components/schemas/ClusterStatus"
      required:
      - created_at
      - created_by
      - generation
      - status
      - updated_at
      - updated_by
      type: object
    ClusterBase:
      allOf:
      - $ref: "#/components/schemas/APIResource"
      properties:
        kind:
          default: Cluster
          type: string
        name:
          description: Cluster name (unique)
          maxLength: 63
          minLength: 1
          pattern: "^[a-z0-9-]+$"
          type: string
        spec:
          allOf:
          - $ref: "#/components/schemas/ClusterSpecCore"
          description: |-
            Cluster specification
            CLM doesn't know how to unmarshall the spec, it only stores and forwards to adapters to do their job
            But CLM will validate the schema before accepting the request
      required:
      - kind
      - name
      - spec
      type: object
    ClusterCreateRequest:
      allOf:
      - $ref: "#/components/schemas/ClusterBase"
      example:
        kind: Cluster
        name: cluster-123
        labels:
          environment: production
          team: platform
        spec: {}
      type: object
    ClusterList:
      allOf:
      - $ref: "#/components/schemas/List"
      example:
        items:
        - kind: Cluster
          id: cluster-123
          href: https://api.hyperfleet.com/v1/clusters/cluster-123
          name: cluster-123
          labels:
            environment: production
            team: platform
          spec: {}
          created_at: 2021-01-01T00:00:00Z
          updated_at: 2021-01-01T00:00:00Z
          generation: 1
          status:
            phase: Ready
            last_transition_time: 2021-01-01T00:00:00Z
            observed_generation: 1
            updated_at: 2021-01-01T00:00:00Z
            adapters:
            - adapter: validator
              type: Available
              status: "True"
              reason: All validations passed
              message: All 30 validation tests passed
              observed_generation: 1
              created_at: 2021-01-01T00:00:00Z
              updated_at: 2021-01-01T00:00:00Z
            - adapter: dns
              type: Available
              status: "True"
              reason: DNS records created
              message: custom.domain.com created
              observed_generation: 1
              created_at: 2021-01-01T00:00:00Z
              updated_at: 2021-01-01T00:00:00Z
          created_by: user-123@example.com
          updated_by: user-123@example.com
        - kind: Cluster
          id: cluster-123
          href: https://api.hyperfleet.com/v1/clusters/cluster-123
          name: cluster-123
          labels:
            environment: production
            team: platform
          spec: {}
          created_at: 2021-01-01T00:00:00Z
          updated_at: 2021-01-01T00:00:00Z
          generation: 1
          status:
            phase: Ready
            last_transition_time: 2021-01-01T00:00:00Z
            observed_generation: 1
            updated_at: 2021-01-01T00:00:00Z
            adapters:
            - adapter: validator
              type: Available
              status: "True"
              reason: All validations passed
              message: All 30 validation tests passed
              observed_generation: 1
              created_at: 2021-01-01T00:00:00Z
              updated_at: 2021-01-01T00:00:00Z
            - adapter: dns
              type: Available
              status: "True"
              reason: DNS records created
              message: custom.domain.com created
              observed_generation: 1
              created_at: 2021-01-01T00:00:00Z
              updated_at: 2021-01-01T00:00:00Z
          created_by: user-123@example.com
          updated_by: user-123@example.com
      properties:
        items:
          items:
            $ref: "#/components/schemas/Cluster"
          type: array
      required:
      - items
      type: object
    ClusterSpecCore:
      description: |-
        Core cluster specification.
        Accepts any properties as the spec is provider-agnostic.
        This is represented as a simple object to allow flexibility.
      type: object
    ClusterStatus:
      description: |-
        Cluster status aggregation from all adapters.

        This object is computed by the service and CANNOT be modified directly.
        It is aggregated from adapter status updates posted to `/clusters/{id}/statuses`.

        Provides quick overview of which adapters have reported and aggregated phase.
      properties:
        phase:
          description: |-
            Current cluster phase (native database column).
            Updated when adapters report status.
            Note: status.phase provides aggregated view from all adapter conditions.
          enum:
          - NotReady
          - Ready
          - Failed
          type: string
        last_transition_time:
          description: |-
            When cluster last transitioned (updated by adapters, used by Sentinel for backoff)
            Updated when adapters report status if the phase changes
          format: date-time
          type: string
        observed_generation:
          description: |-
            Last generation processed by adapters
            Updated when adapters report status.
            This will be the lowest value of each adapter's observed_generation values
            The phase value is based on this generation
          format: int32
          type: integer
        updated_at:
          description: |-
            Time of the last complete report from adapters
            Updated when adapters report status.
            Oldest `updated_at` from the adapter conditions
          format: date-time
          type: string
        adapters:
          items:
            $ref: "#/components/schemas/ConditionAvailable"
          type: array
      required:
      - adapters
      - last_transition_time
      - observed_generation
      - phase
      - updated_at
      type: object
    Condition:
      example:
        reason: reason
        adapter: adapter
        updated_at: 2000-01-23T04:56:07.000+00:00
        created_at: 2000-01-23T04:56:07.000+00:00
        last_transition_time: 2000-01-23T04:56:07.000+00:00
        type: type
        message: message
        observed_generation: 6
        status: "True"
      properties:
        adapter:
          description: Adapter name
          type: string
        type:
          type: string
        status:
          description: Condition status
          enum:
          - "True"
          - "False"
          - Unknown
          type: string
        reason:
          description: Machine-readable reason code
          type: string
        message:
          description: Human-readable message
          type: string
        observed_generation:
          format: int32
          type: integer
        created_at:
          description: |-
            Time when the condition was created
            - In an adapter reporting conditions `updated_at==created_at`
            - In the API, `created_at` doesn't change with new updates from adapters
          format: date-time
          type: string
        updated_at:
          description: Time when the condition was updated
          format: date-time
          type: string
        last_transition_time:
          description: When this condition last transitioned (computed by service
            when status changes)
          format: date-time
          type: string
      required:
      - adapter
      - created_at
      - observed_generation
      - status
      - type
      - updated_at
      type: object
    ConditionAvailable:
      allOf:
      - $ref: "#/components/schemas/ConditionBase"
      description: |-
        StatusAvailable is the status condition from an adapter that is used by CLM to compute the phase.
        `phase=ready` when all adaptors report `Available=true`
      example:
        type: Available
      properties:
        type:
          enum:
          - Available
          type: string
      required:
      - type
      type: object
    ConditionBase:
      description: |-
        Common data for status objects, part of:
        - Status entity (stored in DB)
        - Request payload
      properties:
        adapter:
          description: Adapter name
          type: string
        type:
          type: string
        status:
          description: Condition status
          enum:
          - "True"
          - "False"
          - Unknown
          type: string
        reason:
          description: Machine-readable reason code
          type: string
        message:
          description: Human-readable message
          type: string
        observed_generation:
          format: int32
          type: integer
        created_at:
          description: |-
            Time when the condition was created
            - In an adapter reporting conditions `updated_at==created_at`
            - In the API, `created_at` doesn't change with new updates from adapters
          format: date-time
          type: string
        updated_at:
          description: Time when the condition was updated
          format: date-time
          type: string
      required:
      - adapter
      - created_at
      - observed_generation
      - status
      - type
      - updated_at
      type: object
    Error:
      example:
        reason: reason
        code: code
        kind: kind
        operation_id: operation_id
        id: id
        href: href
      properties:
        id:
          type: string
        kind:
          description: Resource kind
          type: string
        href:
          description: Resource URI
          type: string
        code:
          type: string
        reason:
          type: string
        operation_id:
          type: string
      type: object
    List:
      properties:
        kind:
          type: string
        page:
          format: int32
          type: integer
        size:
          format: int32
          type: integer
        total:
          format: int32
          type: integer
        items:
          items: {}
          type: array
      required:
      - items
      - kind
      - page
      - size
      - total
      type: object
    NodePool:
      allOf:
      - $ref: "#/components/schemas/NodePoolBase"
      example:
        updated_at: 2000-01-23T04:56:07.000+00:00
        owner_references:
          kind: kind
          id: id
          href: href
        updated_by: updated_by
        created_at: 2000-01-23T04:56:07.000+00:00
        created_by: created_by
        status:
          phase: NotReady
          adapters:
          - type: Available
          - type: Available
          updated_at: 2000-01-23T04:56:07.000+00:00
          last_transition_time: 2000-01-23T04:56:07.000+00:00
          observed_generation: 1
      properties:
        created_at:
          format: date-time
          type: string
        updated_at:
          format: date-time
          type: string
        created_by:
          format: email
          type: string
        updated_by:
          format: email
          type: string
        owner_references:
          $ref: "#/components/schemas/ObjectReference"
        status:
          $ref: "#/components/schemas/NodePoolStatus"
      required:
      - created_at
      - created_by
      - owner_references
      - status
      - updated_at
      - updated_by
      type: object
    NodePoolBase:
      properties:
        labels:
          additionalProperties:
            type: string
          description: labels for the API resource as pairs of name:value strings
          type: object
        id:
          description: Resource identifier
          type: string
        kind:
          description: Resource kind
          type: string
        href:
          description: Resource URI
          type: string
        name:
          description: NodePool name (unique in a cluster)
          type: string
        spec:
          allOf:
          - $ref: "#/components/schemas/NodePoolSpecCore"
          description: |-
            Cluster specification
            CLM doesn't know how to unmarshall the spec, it only stores and forwards to adapters to do their job
            But CLM will validate the schema before accepting the request
      required:
      - name
      - spec
      type: object
    NodePoolCreateRequest:
      example:
        kind: kind
        name: name
        id: id
        href: href
        spec: ""
        labels:
          key: labels
      properties:
        labels:
          additionalProperties:
            type: string
          description: labels for the API resource as pairs of name:value strings
          type: object
        id:
          description: Resource identifier
          type: string
        kind:
          description: Resource kind
          type: string
        href:
          description: Resource URI
          type: string
        name:
          description: NodePool name (unique in a cluster)
          type: string
        spec:
          allOf:
          - $ref: "#/components/schemas/NodePoolSpecCore"
          description: |-
            Cluster specification
            CLM doesn't know how to unmarshall the spec, it only stores and forwards to adapters to do their job
            But CLM will validate the schema before accepting the request
      required:
      - name
      - spec
      type: object
    NodePoolCreateResponse:
      example:
        updated_at: 2000-01-23T04:56:07.000+00:00
        owner_references:
          kind: kind
          id: id
          href: href
        kind: kind
        updated_by: updated_by
        name: name
        created_at: 2000-01-23T04:56:07.000+00:00
        id: id
        href: href
        created_by: created_by
        spec: ""
        status:
          phase: NotReady
          adapters:
          - type: Available
          - type: Available
          updated_at: 2000-01-23T04:56:07.000+00:00
          last_transition_time: 2000-01-23T04:56:07.000+00:00
          observed_generation: 1
        labels:
          key: labels
      properties:
        created_at:
          format: date-time
          type: string
        updated_at:
          format: date-time
          type: string
        created_by:
          format: email
          type: string
        updated_by:
          format: email
          type: string
        owner_references:
          $ref: "#/components/schemas/ObjectReference"
        status:
          $ref: "#/components/schemas/NodePoolStatus"
        labels:
          additionalProperties:
            type: string
          description: labels for the API resource as pairs of name:value strings
          type: object
        id:
          description: Resource identifier
          type: string
        kind:
          description: Resource kind
          type: string
        href:
          description: Resource URI
          type: string
        name:
          description: NodePool name (unique in a cluster)
          type: string
        spec:
          allOf:
          - $ref: "#/components/schemas/NodePoolSpecCore"
          description: |-
            Cluster specification
            CLM doesn't know how to unmarshall the spec, it only stores and forwards to adapters to do their job
            But CLM will validate the schema before accepting the request
      required:
      - created_at
      - created_by
      - name
      - owner_references
      - spec
      - status
      - updated_at
      - updated_by
      type: object
    NodePoolList:
      allOf:
      - $ref: "#/components/schemas/List"
      example:
        items:
        - updated_at: 2000-01-23T04:56:07.000+00:00
          owner_references:
            kind: kind
            id: id
            href: href
          updated_by: updated_by
          created_at: 2000-01-23T04:56:07.000+00:00
          created_by: created_by
          status:
            phase: NotReady
            adapters:
            - type: Available
            - type: Available
            updated_at: 2000-01-23T04:56:07.000+00:00
            last_transition_time: 2000-01-23T04:56:07.000+00:00
            observed_generation: 1
        - updated_at: 2000-01-23T04:56:07.000+00:00
          owner_references:
            kind: kind
            id: id
            href: href
          updated_by: updated_by
          created_at: 2000-01-23T04:56:07.000+00:00
          created_by: created_by
          status:
            phase: NotReady
            adapters:
            - type: Available
            - type: Available
            updated_at: 2000-01-23T04:56:07.000+00:00
            last_transition_time: 2000-01-23T04:56:07.000+00:00
            observed_generation: 1
      properties:
        items:
          items:
            $ref: "#/components/schemas/NodePool"
          type: array
      required:
      - items
      type: object
    NodePoolSpecCore:
      description: |-
        Core nodepool specification.
        Accepts any properties as the spec is provider-agnostic.
        This is represented as a simple object to allow flexibility.
      type: object
    NodePoolStatus:
      description: |-
        NodePool status aggregation from all adapters.

        This object is computed by the service and CANNOT be modified directly.
      example:
        phase: NotReady
        adapters:
        - type: Available
        - type: Available
        updated_at: 2000-01-23T04:56:07.000+00:00
        last_transition_time: 2000-01-23T04:56:07.000+00:00
        observed_generation: 1
      properties:
        phase:
          description: |-
            Current NodePool phase (native database column).
            Updated when adapters report status.
            Note: status.phase provides aggregated view from all adapter conditions.
          enum:
          - NotReady
          - Ready
          - Failed
          type: string
        observed_generation:
          description: |-
            Last generation processed by adapters
            Updated when adapters report status.
            This will be the lowest value of each adapter's observed_generation values
            The phase value is based on this generation
          format: int32
          minimum: 1
          type: integer
        last_transition_time:
          description: "When NodePool last transitioned (updated by adapters, used\
            \ by Sentinel for backoff)"
          format: date-time
          type: string
        updated_at:
          description: |-
            Time of the last complete report from adapters
            Updated when adapters report status.
            Oldest `updated_at` from the adapter conditions
          format: date-time
          type: string
        adapters:
          items:
            $ref: "#/components/schemas/ConditionAvailable"
          type: array
      required:
      - adapters
      - last_transition_time
      - observed_generation
      - phase
      - updated_at
      type: object
    ObjectReference:
      example:
        kind: kind
        id: id
        href: href
      properties:
        id:
          description: Resource identifier
          type: string
        kind:
          description: Resource kind
          type: string
        href:
          description: Resource URI
          type: string
      type: object
    OrderDirection:
      enum:
      - asc
      - desc
      type: string
    AdapterStatus_metadata:
      description: Metadata about the adapter job/execution
      properties:
        job_name:
          type: string
        job_namespace:
          type: string
        attempt:
          format: int32
          type: integer
        started_at:
          type: string
        completed_at:
          type: string
        duration:
          type: string
      type: object
  securitySchemes:
    BearerAuth:
      scheme: Bearer
      type: http
